"use strict";(self.webpackChunknew_york_bagels_club=self.webpackChunknew_york_bagels_club||[]).push([[5514,3190],{5927:(e,t,a)=>{a.d(t,{Z:()=>n});a(2791);const n=a.p+"static/media/lock-1.48caf73e8d95f2ad2fabcca7f71c1575.svg"},1227:(e,t,a)=>{a.d(t,{Z:()=>n});a(2791);const n=a.p+"static/media/stripe.09dd69525681575cdc05aa0a30bc6d59.svg"},5241:(e,t,a)=>{a.d(t,{Z:()=>n});a(2791);const n=a.p+"static/media/x.b3295ae9ce0a3b7b53fbb42a0c049fa1.svg"},423:(e,t,a)=>{a.r(t),a.d(t,{default:()=>g});var n=a(2791),o=a(7579),s=a(4545),r=a(5262),i=a(5241),c=a(184);function l(e){let{cartItem:t,setCart:a}=e;const[s,r]=(0,n.useState)(t.quantity),[l,u]=(0,n.useState)((0,o.Z6)(t)),[d,h]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{r(t.quantity),u((0,o.Z6)(t))}),[t.quantity,t]),(0,c.jsxs)("tr",{children:[(0,c.jsxs)("td",{className:"item-name",children:[t.itemData.name," ",(0,o.Lb)(t)]}),(0,c.jsx)("td",{children:(0,c.jsx)("input",{type:"number",value:s,onChange:e=>{(0,o.Lc)(e,r,t,a,d,h,t.selection||"",!1)}})}),(0,c.jsxs)("td",{className:"item-subtotal",children:["$",l.toFixed(2)]}),(0,c.jsx)("td",{className:"item-remove-wrapper",children:(0,c.jsx)("button",{className:"button-styled",onClick:()=>{(0,o.qi)(0,t.itemData._id,a,d,h,t.selection||"",!1)},children:(0,c.jsx)("img",{src:i.Z,alt:"remove from cart",loading:"lazy"})})})]})}var u=a(6795),d=a(1227),h=a(5927);function m(e){let{isSidebarExpanded:t,setIsSidebarExpanded:a,cart:o,setCart:s}=e;const[r,i]=(0,n.useState)(function(){const e=new Date,t=e.getDay(),a=t<=2?3-t:10-t,n=e.getTime()+24*a*60*60*1e3;return new Date(n).toISOString().split("T")[0]}()),[m,g]=(0,n.useState)(!1),[p,f]=(0,n.useState)(""),y=function(e){const t=function(e){const t=new Date(e),a=(new Date).toLocaleString("en-US",{timeZone:"America/New_York"}),n=new Date(t.toLocaleString("en-US",{timeZone:"America/New_York"})),o=2===n.getDay()||3===n.getDay(),s=n.getTime()>new Date(a).getTime();return o&&s}(e);t?i(new Date(e).toISOString().split("T")[0]):alert("You have selected an invalid date, please select a future Wednesday or Thursday.")};return(0,c.jsx)("section",{id:"pre-checkout",className:"cart-summary",onClick:()=>{a(!1)},children:(0,c.jsxs)("div",{className:"cart-summary-wrapper",children:[(0,c.jsxs)("div",{className:"calendar-wrapper",children:[(0,c.jsx)("h3",{children:"Choose Your Ship Date"}),(0,c.jsx)("strong",{children:r?"Your order will ship on ".concat(new Date(new Date(r).toLocaleString("en-US",{timeZone:"UTC"})).toDateString()," or the next available business day."):"Please select a Wednesday or Thursday you would like your order shipped on."}),(0,c.jsx)("input",{type:"date",value:r,onChange:e=>y(e.target.value)})]}),(0,c.jsxs)("div",{className:"basket-wrapper",children:[(0,c.jsx)("h3",{children:"Basket"}),(0,c.jsxs)("table",{children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{className:"item-name",children:"Name"}),(0,c.jsx)("th",{className:"item-quantity",children:"Quantity"}),(0,c.jsx)("th",{className:"item-subtotal",children:"Subtotal"}),(0,c.jsx)("th",{className:"item-remove",children:"Remove"})]})}),(0,c.jsx)("tbody",{children:o.items.map(((e,t)=>(0,c.jsx)(l,{cartItem:e,setCart:s},t)))})]}),(0,c.jsxs)("div",{className:"cart-subtotal",children:[(0,c.jsx)("span",{children:(0,c.jsxs)("strong",{children:["Basket Subtotal: $",o.subtotalInDollars.toFixed(2)]})}),(0,c.jsx)("b",{className:"cart-shipping-note",children:"We have applied our FREE Priority Shipping offer to your cart. Taxes are calculated at checkout."})]})]}),(0,c.jsxs)("div",{className:"gift-wrapper",children:[(0,c.jsx)("h3",{children:"Is This Order A Gift?"}),(0,c.jsxs)("div",{className:"gift-options-content",children:[(0,c.jsx)("div",{className:"gift-toggle-container",children:(0,c.jsx)("input",{type:"checkbox",checked:m,onChange:e=>g(e.target.checked)})}),!0===m?(0,c.jsx)("div",{className:"gift-options-form",children:(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{children:"Leave A Gift Message (Optional)"}),(0,c.jsx)("textarea",{maxLength:400,value:p,onChange:e=>{f(e.target.value)}})]})}):null]})]}),(0,c.jsxs)("div",{className:"checkout-secured",children:[(0,c.jsx)("p",{children:"Checkout Secured By"}),(0,c.jsx)("img",{alt:"checkout secured by stripe",className:"stripe-footer-img",src:d.Z,loading:"lazy"}),(0,c.jsx)("img",{alt:"this website is secured with ssl",className:"lock-img",src:h.Z,loading:"lazy"})]}),(0,c.jsx)("button",{className:"button-styled",onClick:()=>{!async function(){if(o.subtotalInDollars<=25)alert("Your cart must be at least $25 to checkout.");else if(r){const e={giftMessage:p||"",shipDate:r},t=await fetch("".concat((0,u.F1)(),"/api/shop/carts/create-checkout-session"),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("loginToken")),"cart-token":"Bearer ".concat(localStorage.getItem("cartToken")),"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await t.json();200!==t.status?alert("There was an error retrieving your account information. Please sign in again."):window.location.href=a.sessionUrl}else alert("You must select a ship date for your order to proceed.")}()},children:"Checkout Now"})]})})}function g(){const[e,t]=(0,n.useState)(!0),[a,i]=(0,n.useState)(!1),[l,u]=(0,n.useState)(o.UY),d=(0,n.useRef)(!0);return(0,n.useEffect)((()=>{d.current&&(d.current=!1,(0,o.sQ)(u),(0,s.UA)(t),(0,o.wp)(u))}),[]),0===l.items.length?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(r.default,{cart:l,isExpanded:a,setIsExpanded:i,isSignedIn:e,setIsSignedIn:t}),(0,c.jsxs)("div",{className:"cart-summary",onClick:()=>{i(!1)},children:[(0,c.jsx)("h3",{children:"Basket"}),(0,c.jsx)("strong",{children:"Your Basket is Currently Empty."})]})]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(r.default,{cart:l,isExpanded:a,setIsExpanded:i,isSignedIn:e,setIsSignedIn:t}),(0,c.jsx)(m,{isSidebarExpanded:a,setIsSidebarExpanded:i,cart:l,setCart:u})]})}},6795:(e,t,a)=>{a.d(t,{$J:()=>n,F1:()=>s,ki:()=>r,lK:()=>o});const n=!1,o=2250,s=function(){return"https://nybc-server-f069d08697f3.herokuapp.com"},r=function(){return"https://anthonygleason.github.io/NY-Bagels-Club-Client"};"".concat(s(),"/cart/checkout/success")},4545:(e,t,a)=>{a.d(t,{Fm:()=>s,UA:()=>r,gC:()=>o,hY:()=>i,sg:()=>c});var n=a(6795);const o=async function(e,t){const a=t?"clubCartToken":"cartToken";try{const t=await fetch("".concat((0,n.F1)(),"/api/shop/carts/verify"),{method:"GET",headers:{"Content-Type":"application/json","Cart-Token":"Bearer ".concat(localStorage.getItem(a)),Authorization:"Bearer ".concat(localStorage.getItem("loginToken"))}});if(200!==t.status)throw new Error("No valid cart detected. Either the user does not have a cart token or the token expired.");const o=await t.json();return e(o.cart),o.isValid}catch(o){return console.log(o),!1}},s=async function(e){const t=await fetch("".concat((0,n.F1)(),"/api/shop/carts"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({isClub:e})}),a=await t.json();if(a.cartToken)return a.cartToken},r=async function(e,t,a){let o=!1;if(!localStorage.getItem("loginToken"))return e&&e(!1),t&&t(!1),!1;try{const s=await fetch("".concat((0,n.F1)(),"/api/users/verify"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("loginToken"))}}),r=await s.json();return!1===s.ok||403===s.status?(localStorage.removeItem("loginToken"),o=!1):o=r.isValid,t&&!0===r.isAdmin&&t(!0),e&&e(o),a&&a(r.userID),o}catch(s){return console.log(s),t&&t(!1),!1}},i=async function(e){await fetch("".concat((0,n.F1)(),"/api/users/logout"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("loginToken"))}}),e&&e(!1),localStorage.removeItem("loginToken")},c=async function(e,t,a){try{if(!localStorage.getItem("loginToken"))throw new Error("You are not signed in");const o=await fetch("".concat((0,n.F1)(),"/api/users/membershipLevel"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("loginToken"))}}),s=await o.json();return e&&e(s.membershipLevel),t&&t(s.remainingDeliveries),a&&a(new Date(s.expirationDate).toDateString()),s.membershipLevel}catch(o){return console.log("You are not signed in, showing non-member pricing."),e&&e("Non-Member"),"Non-Member"}}},7579:(e,t,a)=>{a.d(t,{Lb:()=>c,Lc:()=>i,UY:()=>d,W:()=>g,Z6:()=>l,pQ:()=>m,qi:()=>s,r:()=>u,sQ:()=>r,wp:()=>h});var n=a(6795),o=a(4545);const s=async function(e,t,a,r,i,c,l){let u="";u=!1===l?"cartToken":"clubCartToken";try{if(r)throw new Error("A request is already pending. Please wait for the current request to complete.");if(i(!0),!t||e<0)throw new Error("One or more required inputs were left blank.");if(!u)throw new Error("Your request for a local storage cart token was invalid. Did you provide a isClub value to this function?");const d=await fetch("".concat((0,n.F1)(),"/api/shop/carts"),{method:"PUT",headers:{"Content-Type":"application/json","Cart-Token":"Bearer ".concat(localStorage.getItem(u)),Authorization:"Bearer ".concat(localStorage.getItem("loginToken"))},body:JSON.stringify({itemID:t,updatedQuantity:e,selection:c,isClubCart:l||void 0})});if(510===d.status&&alert("You have reached the maximum allowed quantity for the selected item."),403===d.status&&(localStorage.setItem(u,await(0,o.Fm)(l||!1)),s(e,t,a,r,i,c,l)),!d.ok)throw new Error("An error occurred in the request to update the cart.");const h=await d.json();h.cartToken&&h.cart&&(localStorage.setItem(u,h.cartToken),a(h.cart)),i(!1)}catch(d){i(!1)}},r=async function(e,t){try{const a=t?"clubCartToken":"cartToken";localStorage.getItem(a)||localStorage.setItem(a,await(0,o.Fm)(t||!1)),await(0,o.gC)(e,t)||(localStorage.setItem(a,await(0,o.Fm)(t||!1)),e([]))}catch(a){console.log(a)}},i=function(e,t,a,n,o,r,i,c){const l=parseInt(e.target.value);l?s(l,a.itemData._id,n,o,r,i,c):t("")},c=function(e){return"bagel"===e.itemData.cat&&"six"===e.selection?"Six Pack(s)":"bagel"===e.itemData.cat&&"dozen"===e.selection?"Baker's Dozen(s)":"bagel"===e.itemData.cat&&"two"===e.selection?"Two Pack(s)":"spread"===e.itemData.cat&&"halflb"===e.selection?"1/2 LB":"spread"===e.itemData.cat?"One Pound":"pastry"===e.itemData.cat?"Six Pack(s)":"mystery"===e.itemData.cat?"Single(s)":"N/A"},l=function(e){return e.quantity*e.unitPriceInDollars},u=function(e,t,a){if(!e||!e.items)return 0;let n=0;for(let o=0;o<e.items.length;o++){const s=e.items[o];if(s.selection===a&&"bagel"===s.itemData.cat&&s.itemData.name===t){n=s.quantity;break}if("spread"===s.itemData.cat&&s.itemData.name===t){n=s.quantity;break}if("pastry"===s.itemData.cat&&s.itemData.name===t){n=s.quantity;break}}return n},d={items:[],subtotalInDollars:0,taxInDollars:0,totalQuantity:0,discountAmountInDollars:0,finalPriceInDollars:0,desiredShipDate:new Date,isGuest:!1},h=async function(e){const t=localStorage.getItem("cartToken"),a=localStorage.getItem("loginToken");if(t){const o=await fetch("".concat((0,n.F1)(),"/api/shop/carts/applyMembershipPricing"),{method:"POST",headers:{"Content-Type":"application/json","Cart-Token":"Bearer ".concat(t),Authorization:"Bearer ".concat(a)}});if(o.ok){const t=await o.json();localStorage.setItem("cartToken",t.cartToken),e&&e(t.cart),console.log("Membership pricing successfully applied!")}else console.log("User is not a member.")}},m=function(e){let t=0,a=0;return e.items.map((e=>{switch(e.itemData.cat){case"bagel":a+=e.quantity;break;case"spread":t+=e.quantity}})),1===t&&6===a},g=async function(e,t,a,o){if(t)if(o)if(a<=0)alert("You do not have any deliveries remaining this billing cycle.");else{const e=await fetch("".concat((0,n.F1)(),"/api/memberships/create-club-checkout-session"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("loginToken")),"cart-token":"Bearer ".concat(localStorage.getItem("clubCartToken"))},body:JSON.stringify({shipDate:o})}),t=await e.json();t.sessionUrl&&(window.location.href=t.sessionUrl)}else alert("You must select a ship date to place your order.");else alert('To place your order you must have 6 "Two Packs" and 1 "1/2 LB" spread in your cart.')}}}]);
//# sourceMappingURL=5514.270a7fac.chunk.js.map