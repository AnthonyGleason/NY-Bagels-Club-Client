(self.webpackChunknew_york_bagels_club=self.webpackChunknew_york_bagels_club||[]).push([[8815,3190],{5241:(e,t,a)=>{"use strict";a.d(t,{Z:()=>n});a(2791);const n=a.p+"static/media/x.b3295ae9ce0a3b7b53fbb42a0c049fa1.svg"},7297:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>g});var n=a(2791),s=a(7579),r=a(5262),o=a(4545),c=a(1276),i=a(184);function l(e){let{storeItem:t,cart:r,setCart:o}=e;const[c,l]=(0,n.useState)(),[u,d]=(0,n.useState)(!1),h=(0,n.useRef)(!0);return(0,n.useEffect)((()=>{h.current&&(h.current=!1,a(6581)("./".concat(t._id.toString(),".jpg")).then((e=>{l(e.default)})))}),[h]),(0,i.jsx)("div",{className:"club-item",style:{backgroundImage:"url(".concat(c,")")},children:(0,i.jsxs)("div",{className:"club-item-info",children:[(0,i.jsxs)("div",{className:"club-item-desc",children:[(0,i.jsx)("p",{children:t.name}),"bagel"===t.cat?(0,i.jsx)("p",{children:"Two Pack(s)"}):null,"spread"===t.cat?(0,i.jsx)("p",{children:"1/2 LB"}):null]}),"bagel"===t.cat?(0,i.jsx)("button",{onClick:()=>{(0,s.qi)((0,s.r)(r,t.name,"two")+1,t._id.toString(),o,u,d,"two",!0)},children:"+"}):null,"spread"===t.cat?(0,i.jsx)("button",{onClick:()=>{const e="halflb";(0,s.qi)((0,s.r)(r,t.name,e)+1,t._id.toString(),o,u,d,e,!0)},children:"+"}):null]})})}var u=a(5241);function d(e){let{cartItem:t,setCart:a}=e;const[r,o]=(0,n.useState)(!1),[c,l]=(0,n.useState)(t.quantity);return(0,n.useEffect)((()=>{l(t.quantity)}),[t.quantity]),(0,i.jsxs)("div",{className:"club-cart-item",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{children:t.itemData.name}),(0,i.jsxs)("p",{children:["two"===t.selection?"Two Pack(s)":"","halflb"===t.selection?"1/2 LB":""]})]}),(0,i.jsxs)("p",{children:["mystery"===t.itemData.cat?t.quantity+" ":(0,i.jsx)("input",{type:"number",value:c,onChange:e=>{(0,s.Lc)(e,l,t,a,r,o,t.selection||"",!0)}}),"in cart"]}),"mystery"===t.itemData.cat?(0,i.jsx)("button",{type:"button",className:"button-styled",children:(0,i.jsx)("p",{children:"Included"})}):(0,i.jsxs)("button",{type:"button",className:"button-styled",onClick:()=>{(0,s.qi)(0,t.itemData._id,a,r,o,t.selection||"",!0)},children:[(0,i.jsx)("p",{children:"Remove"}),(0,i.jsx)("img",{src:u.Z,alt:"remove from cart"})]})]})}var h=a(8310);const m=a.p+"static/media/up-arrow.49d5d4a0e8b3d38c8d8e11a716d1a863.svg";const p=a.p+"static/media/down-arrow.59e139776c43c103c121fa8b467b3621.svg";function g(){const[e,t]=(0,n.useState)(!1),[a,u]=(0,n.useState)(!1),[g,b]=(0,n.useState)(s.UY),[f,y]=(0,n.useState)(""),[w,x]=(0,n.useState)(0),[k,j]=(0,n.useState)(),[S,v]=(0,n.useState)([]),[T,I]=(0,n.useState)(s.UY),[D,C]=(0,n.useState)(),[N,E]=(0,n.useState)(!1),[P,q]=(0,n.useState)(!1),[F,B]=(0,n.useState)(!1),Y=(0,n.useRef)(!0);return(0,n.useEffect)((()=>{if(T){B(!0);const e=setTimeout((()=>{B(!1)}),1e3);return()=>clearTimeout(e)}}),[T]),(0,n.useEffect)((()=>{q((0,s.pQ)(T))}),[T]),(0,n.useEffect)((()=>{Y.current&&(Y.current=!1,(0,o.UA)(t),(0,s.sQ)(b),(0,c.N)(v),(0,o.sg)(y,x,j),(0,s.sQ)(I,!0))}),[]),e?"Non-Member"===f?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.default,{cart:g,isExpanded:a,setIsExpanded:u,isSignedIn:e,setIsSignedIn:t}),(0,i.jsx)("div",{onClick:()=>{u(!1)},className:"account-settings-message",children:"You must be a club member to access this page."})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.default,{cart:g,isExpanded:a,setIsExpanded:u,isSignedIn:e,setIsSignedIn:t}),(0,i.jsxs)(h.E.div,{animate:{y:F?[5,0]:0,height:N?"75vh":"135px"},transition:{duration:1,ease:"easeInOut"},className:N?"club-cart-snapped-expanded":"club-cart-snapped-closed",children:[(0,i.jsxs)("div",{className:"club-cart-heading",children:[(0,i.jsx)("img",{onClick:()=>{E(!N)},src:!1===N?m:p,alt:"expand menu slider"}),(0,i.jsx)("div",{className:"club-cart-date-wrapper",onClick:()=>{E(!N)},children:D?(0,i.jsxs)(i.Fragment,{children:["Your Selected Ship Day is",(0,i.jsx)("br",{}),(0,i.jsx)("b",{children:D.toDateString()})]}):(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("b",{children:"Please Select A Ship Day"})})}),(0,i.jsx)("button",{onClick:()=>{(0,s.W)(g,P,w,D)},type:"button",className:"club-cart-place-order-button club-cart-valid-background",children:"Place Order"})]}),(0,i.jsx)("div",{className:"club-cart-filled-wrapper",children:(0,i.jsx)("p",{className:"club-cart-valid ".concat(P?"green":"yellow"),children:!0===P?"You cart is full, an order can be placed!":'To place an order you must have 6 "Two Packs" and 1 "1/2 LB" spread in your cart.'})}),T&&T.items.map(((e,t)=>(0,i.jsx)(d,{cartItem:e,setCart:I},t)))]}),(0,i.jsxs)("div",{className:"club",onClick:()=>{u(!1)},children:[(0,i.jsxs)("div",{className:"club-heading",children:[(0,i.jsxs)("h2",{children:["Thank you for being a ",f,"!"]}),(0,i.jsxs)("p",{children:["You have ",(0,i.jsx)("b",{children:w})," ",1===w?"delivery":"deliveries"," remaining left this billing cycle ending on ",(0,i.jsx)("b",{children:k}),"."]}),(0,i.jsxs)("p",{children:["To place a delivery please add ",(0,i.jsx)("b",{children:"six"})," bagel selections and ",(0,i.jsx)("b",{children:"one"})," spread to your cart."]}),(0,i.jsx)("button",{type:"button",onClick:()=>window.location.href="https://billing.stripe.com/p/login/4gw9Bb95Oeo70tadQQ",children:"Manage Subscription"})]}),(0,i.jsxs)("div",{className:"calendar-wrapper",children:[(0,i.jsx)("h3",{children:"Choose Your Ship Date"}),(0,i.jsx)("strong",{children:D?"Your order will ship on ".concat(D.toDateString()," or the next available business day."):"Please select a Wednesday or Thursday you would like your order shipped on."})]}),(0,i.jsx)("div",{className:"club-items-container",children:S&&S.sort(((e,t)=>"bagel"===e.cat&&"bagel"!==t.cat||"pastry"===e.cat&&"bagel"!==t.cat&&"pastry"!==t.cat?-1:1)).map(((e,t)=>"mystery"===e.cat||"pastry"===e.cat?null:(0,i.jsx)(l,{storeItem:e,cart:T,setCart:I},t)))})]})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.default,{cart:g,isExpanded:a,setIsExpanded:u,isSignedIn:e,setIsSignedIn:t}),(0,i.jsx)("div",{onClick:()=>{u(!1)},className:"account-settings-message",children:"You must be signed in to access this page."})]})}},6795:(e,t,a)=>{"use strict";a.d(t,{$J:()=>n,F1:()=>r,ki:()=>o,lK:()=>s});const n=!1,s=4e3,r=function(){return"https://nybc-server-f069d08697f3.herokuapp.com"},o=function(){return"https://nybagelsclub.com/"};"".concat(r(),"/cart/checkout/success")},4545:(e,t,a)=>{"use strict";a.d(t,{Fm:()=>r,UA:()=>o,gC:()=>s,hY:()=>c,sg:()=>i});var n=a(6795);const s=async function(e,t){const a=t?"clubCartToken":"cartToken";try{const t=await fetch("".concat((0,n.F1)(),"/api/shop/carts/verify"),{method:"GET",headers:{"Content-Type":"application/json","Cart-Token":"Bearer ".concat(localStorage.getItem(a)),Authorization:"Bearer ".concat(localStorage.getItem("loginToken"))}});if(200!==t.status)throw new Error("No valid cart detected. Either the user does not have a cart token or the token expired.");const s=await t.json();return e(s.cart),s.isValid}catch(s){return console.log(s),!1}},r=async function(e){const t=await fetch("".concat((0,n.F1)(),"/api/shop/carts"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({isClub:e})}),a=await t.json();if(a.cartToken)return a.cartToken},o=async function(e,t,a){let s=!1;if(!localStorage.getItem("loginToken"))return e&&e(!1),t&&t(!1),!1;try{const r=await fetch("".concat((0,n.F1)(),"/api/users/verify"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("loginToken"))}}),o=await r.json();return!1===r.ok||403===r.status?(localStorage.removeItem("loginToken"),s=!1):s=o.isValid,t&&!0===o.isAdmin&&t(!0),e&&e(s),a&&a(o.userID),s}catch(r){return console.log(r),t&&t(!1),!1}},c=async function(e){await fetch("".concat((0,n.F1)(),"/api/users/logout"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("loginToken"))}}),e&&e(!1),localStorage.removeItem("loginToken")},i=async function(e,t,a){try{if(!localStorage.getItem("loginToken"))throw new Error("You are not signed in");const s=await fetch("".concat((0,n.F1)(),"/api/users/membershipLevel"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("loginToken"))}}),r=await s.json();return e&&e(r.membershipLevel),t&&t(r.remainingDeliveries),a&&a(new Date(r.expirationDate).toDateString()),r.membershipLevel}catch(s){return console.log(s+", showing non-member pricing"),e&&e("Non-Member"),"Non-Member"}}},7579:(e,t,a)=>{"use strict";a.d(t,{Lb:()=>i,Lc:()=>c,UY:()=>d,W:()=>p,Z6:()=>l,pQ:()=>m,qi:()=>r,r:()=>u,sQ:()=>o,wp:()=>h});var n=a(6795),s=a(4545);const r=async function(e,t,a,o,c,i,l){let u="";u=!1===l?"cartToken":"clubCartToken";try{if(o)throw new Error("A request is already pending. Please wait for the current request to complete.");if(c(!0),!t||e<0)throw new Error("One or more required inputs were left blank.");if(!u)throw new Error("Your request for a local storage cart token was invalid. Did you provide a isClub value to this function?");const d=await fetch("".concat((0,n.F1)(),"/api/shop/carts"),{method:"PUT",headers:{"Content-Type":"application/json","Cart-Token":"Bearer ".concat(localStorage.getItem(u)),Authorization:"Bearer ".concat(localStorage.getItem("loginToken"))},body:JSON.stringify({itemID:t,updatedQuantity:e,selection:i,isClubCart:l||void 0})});if(510===d.status&&alert("You have reached the maximum allowed quantity for the selected item."),403===d.status&&(localStorage.setItem(u,await(0,s.Fm)(l||!1)),r(e,t,a,o,c,i,l)),!d.ok)throw new Error("An error occurred in the request to update the cart.");const h=await d.json();h.cartToken&&h.cart&&(localStorage.setItem(u,h.cartToken),a(h.cart)),c(!1)}catch(d){c(!1)}},o=async function(e,t){try{const a=t?"clubCartToken":"cartToken";localStorage.getItem(a)||localStorage.setItem(a,await(0,s.Fm)(t||!1)),await(0,s.gC)(e,t)||(localStorage.setItem(a,await(0,s.Fm)(t||!1)),e([]))}catch(a){console.log(a)}},c=function(e,t,a,n,s,o,c,i){const l=parseInt(e.target.value);l?r(l,a.itemData._id,n,s,o,c,i):t("")},i=function(e){return"bagel"===e.itemData.cat&&"six"===e.selection?"Six Pack(s)":"bagel"===e.itemData.cat&&"dozen"===e.selection?"Baker's Dozen(s)":"bagel"===e.itemData.cat&&"two"===e.selection?"Two Pack(s)":"spread"===e.itemData.cat&&"halflb"===e.selection?"1/2 LB":"spread"===e.itemData.cat?"One Pound":"pastry"===e.itemData.cat?"Six Pack(s)":"mystery"===e.itemData.cat?"Single(s)":"N/A"},l=function(e){return e.quantity*e.unitPriceInDollars},u=function(e,t,a){if(!e||!e.items)return 0;let n=0;for(let s=0;s<e.items.length;s++){const r=e.items[s];if(r.selection===a&&"bagel"===r.itemData.cat&&r.itemData.name===t){n=r.quantity;break}if("spread"===r.itemData.cat&&r.itemData.name===t){n=r.quantity;break}if("pastry"===r.itemData.cat&&r.itemData.name===t){n=r.quantity;break}}return n},d={items:[],subtotalInDollars:0,taxInDollars:0,totalQuantity:0,discountAmountInDollars:0,finalPriceInDollars:0,desiredShipDate:new Date,isGuest:!1},h=async function(e){const t=localStorage.getItem("cartToken"),a=localStorage.getItem("loginToken");if(t){const s=await fetch("".concat((0,n.F1)(),"/api/shop/carts/applyMembershipPricing"),{method:"POST",headers:{"Content-Type":"application/json","Cart-Token":"Bearer ".concat(t),Authorization:"Bearer ".concat(a)}});if(s.ok){const t=await s.json();localStorage.setItem("cartToken",t.cartToken),e&&e(t.cart),console.log("Membership pricing successfully applied!")}else console.log("User is not a member.")}},m=function(e){let t=0,a=0;return e.items.map((e=>{switch(e.itemData.cat){case"bagel":a+=e.quantity;break;case"spread":t+=e.quantity}})),1===t&&6===a},p=async function(e,t,a,s){if(t)if(s)if(a<=0)alert("You do not have any deliveries remaining this billing cycle.");else{const e=await fetch("".concat((0,n.F1)(),"/api/memberships/create-club-checkout-session"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("loginToken")),"cart-token":"Bearer ".concat(localStorage.getItem("clubCartToken"))},body:JSON.stringify({shipDate:s})}),t=await e.json();t.sessionUrl&&(window.location.href=t.sessionUrl)}else alert("You must select a ship date to place your order.");else alert('To place your order you must have 6 "Two Packs" and 1 "1/2 LB" spread in your cart.')}},1276:(e,t,a)=>{"use strict";a.d(t,{N:()=>s});var n=a(6795);const s=async function(e,t){try{const a=await fetch("".concat((0,n.F1)(),"/api/shop/all"),{method:"GET"}),s=await a.json(),{bagelItems:r,pastryItems:o}=s;if(!r||!o)throw new Error("There was an error retrieving shop items.");e&&r&&e(r),t&&o&&t(o)}catch(a){console.log("There was an error ".concat(a," when retrieving shop items."))}}},6581:e=>{function t(e){return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}t.keys=()=>[],t.resolve=t,t.id=6581,e.exports=t}}]);
//# sourceMappingURL=8815.c1d71be7.chunk.js.map