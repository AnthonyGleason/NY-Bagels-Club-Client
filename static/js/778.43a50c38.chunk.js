"use strict";(self.webpackChunknew_york_bagels_club=self.webpackChunknew_york_bagels_club||[]).push([[778,3190],{9032:(e,t,a)=>{a.r(t),a.d(t,{default:()=>u});var o=a(2791),n=a(4545),r=a(5262),s=a(7579),i=a(5381),c=a(7689),l=a(184);function u(){const[e,t]=(0,o.useState)(""),[a,u]=(0,o.useState)(""),[d,h]=(0,o.useState)(""),[p,g]=(0,o.useState)(""),[m,w]=(0,o.useState)(""),[f,y]=(0,o.useState)(""),[k,T]=(0,o.useState)(!0),[b,v]=(0,o.useState)(!1),[S,j]=(0,o.useState)(s.UY),I=(0,c.s0)();return(0,o.useEffect)((()=>{(0,n.UA)(T),(0,s.sQ)(j)}),[]),(0,o.useEffect)((()=>{(0,i.Mm)(t,u,h)}),[k]),k?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.default,{cart:S,isExpanded:b,setIsExpanded:v,isSignedIn:k,setIsSignedIn:T}),(0,l.jsxs)("div",{onClick:()=>{v(!1)},className:"account-settings",children:[(0,l.jsx)("h3",{children:"Account Settings"}),(0,l.jsxs)("div",{className:"settings-input-wrapper",children:[(0,l.jsx)("label",{children:"First Name"}),(0,l.jsx)("input",{value:e,onChange:e=>{t(e.target.value)},type:"text"})]}),(0,l.jsxs)("div",{className:"settings-input-wrapper",children:[(0,l.jsx)("label",{children:"Last Name"}),(0,l.jsx)("input",{value:a,onChange:e=>{u(e.target.value)},type:"text"})]}),(0,l.jsx)("h4",{children:"The following setting will change your login email."}),(0,l.jsxs)("div",{className:"settings-input-wrapper",children:[(0,l.jsx)("label",{children:"Email"}),(0,l.jsx)("input",{value:d,onChange:e=>{h(e.target.value)},type:"email"})]}),(0,l.jsx)("h4",{children:"The following setting will change your login password."}),(0,l.jsxs)("div",{className:"settings-input-wrapper",children:[(0,l.jsx)("label",{children:"New Password"}),(0,l.jsx)("input",{value:p,onChange:e=>{g(e.target.value)},type:"password"})]}),(0,l.jsxs)("div",{className:"settings-input-wrapper",children:[(0,l.jsx)("label",{children:"New Password (Again)"}),(0,l.jsx)("input",{value:m,onChange:e=>{w(e.target.value)},type:"password"})]}),(0,l.jsx)("h4",{children:"You must enter your current password to apply any of the settings changes above."}),(0,l.jsxs)("div",{className:"settings-input-wrapper",children:[(0,l.jsx)("label",{children:"Current Password"}),(0,l.jsx)("input",{value:f,onChange:e=>{y(e.target.value)},type:"password",required:!0})]}),(0,l.jsx)("button",{className:"apply-account-settings",type:"button",onClick:()=>{(0,i.tI)(e,a,d,p,m,f,I)},children:"Apply Changes"})]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.default,{cart:S,isExpanded:b,setIsExpanded:v,isSignedIn:k,setIsSignedIn:T}),(0,l.jsx)("div",{onClick:()=>{v(!1)},className:"account-settings-message",children:"You must be signed in to access this page."})]})}},6795:(e,t,a)=>{a.d(t,{$J:()=>o,F1:()=>r,ki:()=>s,lK:()=>n});const o=!1,n=2250,r=function(){return"https://nybc-server-f069d08697f3.herokuapp.com"},s=function(){return"https://anthonygleason.github.io/NY-Bagels-Club-Client"};"".concat(r(),"/cart/checkout/success")},5381:(e,t,a)=>{a.d(t,{Cv:()=>d,Mm:()=>s,OO:()=>u,Yg:()=>c,ju:()=>h,mW:()=>l,sJ:()=>p,tI:()=>i});var o=a(6795),n=a(5739),r=a(184);const s=async function(e,t,a){try{const n=localStorage.getItem("loginToken");if(!n)throw new Error("A login token was not provided! Are you logged in?");const r=await fetch("".concat((0,o.F1)(),"/api/users/settings"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)}});if(!r.ok)throw new Error("Failed to fetch account settings");const s=await r.json();e&&e(s.firstName),t&&t(s.lastName),a&&a(s.email)}catch(n){console.log(n)}},i=async function(e,t,a,r,s,i,c){try{if(!e||!t||!a||!i)throw new Error("The first name, last name, email and current password fields are required.");if(!(0,n.v)(a))throw new Error("The provided email is not a valid email");if(r&&s&&r!==s)throw new Error("New passwords do not match!");const l=await fetch("".concat((0,o.F1)(),"/api/users/settings"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("loginToken"))},body:JSON.stringify({firstName:e,lastName:t,emailInput:a,passwordInput:r,passwordConfInput:s,currentPasswordInput:i})});if(!l.ok)throw new Error("Failed to apply new account settings");const u=await l.json();if(u.wasUserUpdated){if(!u.loginToken)throw localStorage.removeItem("loginToken"),new Error("A new login token was not provided!");localStorage.setItem("loginToken",u.loginToken),c("/")}}catch(l){console.log(l)}},c=async function(e,t){try{const a=await fetch("".concat((0,o.F1)(),"/api/users/forgotPassword/").concat(e),{method:"GET"});if(!a.ok)throw new Error("Failed to get password reset token status.");t((await a.json()).isExpired)}catch(a){console.log(a)}},l=async function(e,t,a,n,r,s){try{if(!e||!t||!a)throw new Error("Required inputs are missing!");if(t!==a)throw new Error("Passwords do not match!");const i=await fetch("".concat((0,o.F1)(),"/api/users/forgotPassword/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:t,passwordConf:a})});if(!i.ok)throw new Error("Failed to submit the forgot password form. Please try again later.");const c=await i.json();n(c.isExpired),c.wasUpdated&&r("/login"),c.isExpired||s("Passwords do not match or user does not exist.")}catch(i){console.log(i)}},u=function(e){return e?(0,r.jsx)("p",{className:"login-error-message",children:e}):null},d=async function(e,t,a,r){try{if(!e||!t){const e="* Please ensure both the email and password fields are completed before submitting this form.";throw a(e),new Error(e)}if(!(0,n.v)(e)){const e="* Please enter a valid email to submit this form";throw a(e),new Error(e)}const s=await fetch("".concat((0,o.F1)(),"/api/users/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!s.ok)throw new Error("Failed to log in user.");const i=await s.json();if(!i.token)throw a(i.message),new Error(i.message);localStorage.setItem("loginToken",i.token),r("/")}catch(s){console.log(s)}},h=async function(e,t){try{if(!e){const e="* The email field cannot be left blank.";throw t(e),new Error(e)}if(!(0,n.v)(e)){const e="* Please ensure you have entered a valid email.";throw t(e),new Error(e)}const a=await fetch("".concat((0,o.F1)(),"/api/users/forgotPassword"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(!a.ok)throw new Error("Failed to request a forgot password email.");(await a.json()).isEmailSent&&alert("Your request has been processed. If an account exists for the provided email address you will recieve an email with a password reset link.")}catch(a){console.log(a)}},p=async function(e,t,a,r,s,i,c,l){if(!c)try{if(!e||!t||!a||!r||!s){const e="* Please ensure all fields are completed before submitting this form.";throw i(e),new Error(e)}if(!(0,n.v)(e)){const e="* Please enter a valid email to submit this form";throw i(e),new Error(e)}if(t!==a){const e="* Entered passwords do not match.";throw i(e),new Error(e)}const c=await fetch("".concat((0,o.F1)(),"/api/users/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:r,lastName:s,email:e,password:t,passwordConfirm:a})});if(l(!0),!c.ok)throw new Error("An error has occured when registering the new user.");const u=await c.json();u.token?(localStorage.setItem("loginToken",u.token),l(!0),window.history.back()):(i(u.message),l(!1))}catch(u){console.log(u)}}},4545:(e,t,a)=>{a.d(t,{Fm:()=>r,UA:()=>s,gC:()=>n,hY:()=>i,sg:()=>c});var o=a(6795);const n=async function(e,t){const a=t?"clubCartToken":"cartToken";try{const t=await fetch("".concat((0,o.F1)(),"/api/shop/carts/verify"),{method:"GET",headers:{"Content-Type":"application/json","Cart-Token":"Bearer ".concat(localStorage.getItem(a)),Authorization:"Bearer ".concat(localStorage.getItem("loginToken"))}});if(200!==t.status)throw new Error("No valid cart detected. Either the user does not have a cart token or the token expired.");const n=await t.json();return e(n.cart),n.isValid}catch(n){return console.log(n),!1}},r=async function(e){const t=await fetch("".concat((0,o.F1)(),"/api/shop/carts"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({isClub:e})}),a=await t.json();if(a.cartToken)return a.cartToken},s=async function(e,t,a){let n=!1;if(!localStorage.getItem("loginToken"))return e&&e(!1),t&&t(!1),!1;try{const r=await fetch("".concat((0,o.F1)(),"/api/users/verify"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("loginToken"))}}),s=await r.json();return!1===r.ok||403===r.status?(localStorage.removeItem("loginToken"),n=!1):n=s.isValid,t&&!0===s.isAdmin&&t(!0),e&&e(n),a&&a(s.userID),n}catch(r){return console.log(r),t&&t(!1),!1}},i=async function(e){await fetch("".concat((0,o.F1)(),"/api/users/logout"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("loginToken"))}}),e&&e(!1),localStorage.removeItem("loginToken")},c=async function(e,t,a){try{if(!localStorage.getItem("loginToken"))throw new Error("You are not signed in");const n=await fetch("".concat((0,o.F1)(),"/api/users/membershipLevel"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("loginToken"))}}),r=await n.json();return e&&e(r.membershipLevel),t&&t(r.remainingDeliveries),a&&a(new Date(r.expirationDate).toDateString()),r.membershipLevel}catch(n){return console.log("You are not signed in, showing non-member pricing."),e&&e("Non-Member"),"Non-Member"}}},7579:(e,t,a)=>{a.d(t,{Lb:()=>c,Lc:()=>i,UY:()=>d,W:()=>g,Z6:()=>l,pQ:()=>p,qi:()=>r,r:()=>u,sQ:()=>s,wp:()=>h});var o=a(6795),n=a(4545);const r=async function(e,t,a,s,i,c,l){let u="";u=!1===l?"cartToken":"clubCartToken";try{if(s)throw new Error("A request is already pending. Please wait for the current request to complete.");if(i(!0),!t||e<0)throw new Error("One or more required inputs were left blank.");if(!u)throw new Error("Your request for a local storage cart token was invalid. Did you provide a isClub value to this function?");const d=await fetch("".concat((0,o.F1)(),"/api/shop/carts"),{method:"PUT",headers:{"Content-Type":"application/json","Cart-Token":"Bearer ".concat(localStorage.getItem(u)),Authorization:"Bearer ".concat(localStorage.getItem("loginToken"))},body:JSON.stringify({itemID:t,updatedQuantity:e,selection:c,isClubCart:l||void 0})});if(510===d.status&&alert("You have reached the maximum allowed quantity for the selected item."),403===d.status&&(localStorage.setItem(u,await(0,n.Fm)(l||!1)),r(e,t,a,s,i,c,l)),!d.ok)throw new Error("An error occurred in the request to update the cart.");const h=await d.json();h.cartToken&&h.cart&&(localStorage.setItem(u,h.cartToken),a(h.cart)),i(!1)}catch(d){i(!1)}},s=async function(e,t){try{const a=t?"clubCartToken":"cartToken";localStorage.getItem(a)||localStorage.setItem(a,await(0,n.Fm)(t||!1)),await(0,n.gC)(e,t)||(localStorage.setItem(a,await(0,n.Fm)(t||!1)),e([]))}catch(a){console.log(a)}},i=function(e,t,a,o,n,s,i,c){const l=parseInt(e.target.value);l?r(l,a.itemData._id,o,n,s,i,c):t("")},c=function(e){return"bagel"===e.itemData.cat&&"six"===e.selection?"Six Pack(s)":"bagel"===e.itemData.cat&&"dozen"===e.selection?"Baker's Dozen(s)":"bagel"===e.itemData.cat&&"two"===e.selection?"Two Pack(s)":"spread"===e.itemData.cat&&"halflb"===e.selection?"1/2 LB":"spread"===e.itemData.cat?"One Pound":"pastry"===e.itemData.cat?"Six Pack(s)":"mystery"===e.itemData.cat?"Single(s)":"N/A"},l=function(e){return e.quantity*e.unitPriceInDollars},u=function(e,t,a){if(!e||!e.items)return 0;let o=0;for(let n=0;n<e.items.length;n++){const r=e.items[n];if(r.selection===a&&"bagel"===r.itemData.cat&&r.itemData.name===t){o=r.quantity;break}if("spread"===r.itemData.cat&&r.itemData.name===t){o=r.quantity;break}if("pastry"===r.itemData.cat&&r.itemData.name===t){o=r.quantity;break}}return o},d={items:[],subtotalInDollars:0,taxInDollars:0,totalQuantity:0,discountAmountInDollars:0,finalPriceInDollars:0,desiredShipDate:new Date,isGuest:!1},h=async function(e){const t=localStorage.getItem("cartToken"),a=localStorage.getItem("loginToken");if(t){const n=await fetch("".concat((0,o.F1)(),"/api/shop/carts/applyMembershipPricing"),{method:"POST",headers:{"Content-Type":"application/json","Cart-Token":"Bearer ".concat(t),Authorization:"Bearer ".concat(a)}});if(n.ok){const t=await n.json();localStorage.setItem("cartToken",t.cartToken),e&&e(t.cart),console.log("Membership pricing successfully applied!")}else console.log("User is not a member.")}},p=function(e){let t=0,a=0;return e.items.map((e=>{switch(e.itemData.cat){case"bagel":a+=e.quantity;break;case"spread":t+=e.quantity}})),1===t&&6===a},g=async function(e,t,a,n){if(t)if(n)if(a<=0)alert("You do not have any deliveries remaining this billing cycle.");else{const e=await fetch("".concat((0,o.F1)(),"/api/memberships/create-club-checkout-session"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("loginToken")),"cart-token":"Bearer ".concat(localStorage.getItem("clubCartToken"))},body:JSON.stringify({shipDate:n})}),t=await e.json();t.sessionUrl&&(window.location.href=t.sessionUrl)}else alert("You must select a ship date to place your order.");else alert('To place your order you must have 6 "Two Packs" and 1 "1/2 LB" spread in your cart.')}},5739:(e,t,a)=>{a.d(t,{v:()=>o});const o=e=>/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i.test(e)}}]);
//# sourceMappingURL=778.43a50c38.chunk.js.map