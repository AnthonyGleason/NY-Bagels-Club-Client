"use strict";(self.webpackChunknew_york_bagels_club=self.webpackChunknew_york_bagels_club||[]).push([[822],{3045:(e,t,a)=>{a.r(t),a.d(t,{default:()=>k});var n=a(2791),o=a(7579);const i=a.p+"static/media/bubble-loading-white.146cf9c646c19f35ed199d15ac4e2d75.svg";var r=a(6795),s=a(8310);const c=a.p+"static/media/loading.1a6eec1f5c14694aad79.webp";var l=a(184);const u={hidden:{x:"-100%"},visible:{x:0,transition:{duration:.6}}},d={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.6}}};function h(e){let{setIsPageLoaded:t}=e;const[a,o]=(0,n.useState)("");return(0,n.useEffect)((()=>{"devtest"===a&&t(!0)}),[a]),(0,n.useEffect)((()=>{r.$J||setTimeout((()=>{t(!0)}),r.lK)}),[t]),(0,l.jsxs)("div",{className:"init-load",children:[(0,l.jsx)("img",{src:c,className:"init-load-background",sizes:"cover"}),(0,l.jsx)(s.E.img,{className:"loading-spinner",src:i,alt:"This page is currently loading. You will be able to see our delicious bagels and spreads shortly.",initial:"hidden",animate:"visible",variants:u,loading:"lazy"}),(0,l.jsxs)(s.E.header,{initial:"hidden",animate:"visible",variants:d,className:"loading-content-wrapper",children:[(0,l.jsxs)("h3",{children:["New York Bagels Club",(0,l.jsx)("br",{}),'"Always Fresh"']}),!0===r.$J?(0,l.jsxs)("p",{className:"loading-notice",children:["We are undergoing scheduled maintenance and will return shortly. Thank you for your patience!",(0,l.jsx)("input",{placeholder:"Enter password to enter",onChange:e=>{o(e.target.value)}})]}):(0,l.jsxs)("p",{className:"loading-message",children:[(0,l.jsx)("span",{children:"Vacuum-Sealed Authentic New York City Style Bagels Directly From the Heart of Long Island to Your Doorstep!"}),(0,l.jsx)("strong",{className:"loading-notice",children:"No Account or Subscription Required to Order."})]})]})]})}const g=(0,n.lazy)((()=>Promise.all([a.e(5262),a.e(3190)]).then(a.bind(a,5262)))),m=(0,n.lazy)((()=>a.e(8293).then(a.bind(a,9800)))),p=(0,n.lazy)((()=>a.e(3288).then(a.bind(a,3288)))),y=(0,n.lazy)((()=>a.e(5242).then(a.bind(a,8947)))),f=(0,n.lazy)((()=>a.e(2540).then(a.bind(a,2540)))),b=(0,n.lazy)((()=>a.e(2400).then(a.bind(a,2400))));function k(){const[e,t]=(0,n.useState)(!1),[a,i]=(0,n.useState)(!1),[r,s]=(0,n.useState)(o.UY),[c,u]=(0,n.useState)(!1),d=(0,n.useRef)(!0);return(0,n.useEffect)((()=>{if(d.current){d.current=!1;localStorage.getItem("cartToken")&&(0,o.sQ)(s)}}),[d]),c?(0,l.jsxs)("main",{className:"home",children:[(0,l.jsx)(g,{cart:r,isExpanded:a,setIsExpanded:i,isSignedIn:e,setIsSignedIn:t}),(0,l.jsxs)("div",{className:"home-content-wrapper",onClick:()=>{i(!1)},children:[(0,l.jsx)(y,{}),(0,l.jsx)(m,{}),(0,l.jsx)(f,{isSignedIn:e,cart:r,setCart:s}),(0,l.jsx)(b,{}),(0,l.jsx)(p,{})]})]}):(0,l.jsx)(h,{setIsPageLoaded:u})}},6795:(e,t,a)=>{a.d(t,{$J:()=>n,F1:()=>i,ki:()=>r,lK:()=>o});const n=!1,o=1800,i=function(){return"https://nybagelsclub-7eb3cdcd8d53.herokuapp.com"},r=function(){return"https://anthonygleason.github.io/NY-Bagels-Club-Client"};"".concat(i(),"/cart/checkout/success")},4545:(e,t,a)=>{a.d(t,{Fm:()=>i,UA:()=>r,gC:()=>o,hY:()=>s,sg:()=>c});var n=a(6795);const o=async function(e,t){const a=t?"clubCartToken":"cartToken";try{const t=await fetch("".concat((0,n.F1)(),"/api/shop/carts/verify"),{method:"GET",headers:{"Content-Type":"application/json","Cart-Token":"Bearer ".concat(localStorage.getItem(a)),Authorization:"Bearer ".concat(localStorage.getItem("loginToken"))}});if(200!==t.status)throw new Error("No valid cart detected. Either the user does not have a cart token or the token expired.");const o=await t.json();return e(o.cart),o.isValid}catch(o){return console.log(o),!1}},i=async function(e){const t=await fetch("".concat((0,n.F1)(),"/api/shop/carts"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({isClub:e})}),a=await t.json();if(a.cartToken)return a.cartToken},r=async function(e,t,a){let o=!1;if(!localStorage.getItem("loginToken"))return e&&e(!1),t&&t(!1),!1;try{const i=await fetch("".concat((0,n.F1)(),"/api/users/verify"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("loginToken"))}}),r=await i.json();return!1===i.ok||403===i.status?(localStorage.removeItem("loginToken"),o=!1):o=r.isValid,t&&!0===r.isAdmin&&t(!0),e&&e(o),a&&a(r.userID),o}catch(i){return console.log(i),t&&t(!1),!1}},s=async function(e){await fetch("".concat((0,n.F1)(),"/api/users/logout"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("loginToken"))}}),e&&e(!1),localStorage.removeItem("loginToken")},c=async function(e,t,a){try{if(!localStorage.getItem("loginToken"))throw new Error("You are not signed in");const o=await fetch("".concat((0,n.F1)(),"/api/users/membershipLevel"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("loginToken"))}}),i=await o.json();return e&&e(i.membershipLevel),t&&t(i.remainingDeliveries),a&&a(new Date(i.expirationDate).toDateString()),i.membershipLevel}catch(o){return console.log("You are not signed in, showing non-member pricing."),e&&e("Non-Member"),"Non-Member"}}},7579:(e,t,a)=>{a.d(t,{Lb:()=>c,Lc:()=>s,UY:()=>d,W:()=>m,Z6:()=>l,pQ:()=>g,qi:()=>i,r:()=>u,sQ:()=>r,wp:()=>h});var n=a(6795),o=a(4545);const i=async function(e,t,a,r,s,c,l){let u="";u=!1===l?"cartToken":"clubCartToken";try{if(r)throw new Error("A request is already pending. Please wait for the current request to complete.");if(s(!0),!t||e<0)throw new Error("One or more required inputs were left blank.");if(!u)throw new Error("Your request for a local storage cart token was invalid. Did you provide a isClub value to this function?");const d=await fetch("".concat((0,n.F1)(),"/api/shop/carts"),{method:"PUT",headers:{"Content-Type":"application/json","Cart-Token":"Bearer ".concat(localStorage.getItem(u)),Authorization:"Bearer ".concat(localStorage.getItem("loginToken"))},body:JSON.stringify({itemID:t,updatedQuantity:e,selection:c,isClubCart:l||void 0})});if(510===d.status&&alert("You have reached the maximum allowed quantity for the selected item."),403===d.status&&(localStorage.setItem(u,await(0,o.Fm)(l||!1)),i(e,t,a,r,s,c,l)),!d.ok)throw new Error("An error occurred in the request to update the cart.");const h=await d.json();h.cartToken&&h.cart&&(localStorage.setItem(u,h.cartToken),a(h.cart)),s(!1)}catch(d){s(!1)}},r=async function(e,t){try{const a=t?"clubCartToken":"cartToken";localStorage.getItem(a)||localStorage.setItem(a,await(0,o.Fm)(t||!1)),await(0,o.gC)(e,t)||(localStorage.setItem(a,await(0,o.Fm)(t||!1)),e([]))}catch(a){console.log(a)}},s=function(e,t,a,n,o,r,s,c){const l=parseInt(e.target.value);l?i(l,a.itemData._id,n,o,r,s,c):t("")},c=function(e){return"bagel"===e.itemData.cat&&"six"===e.selection?"Six Pack(s)":"bagel"===e.itemData.cat&&"dozen"===e.selection?"Baker's Dozen(s)":"bagel"===e.itemData.cat&&"two"===e.selection?"Two Pack(s)":"spread"===e.itemData.cat&&"halflb"===e.selection?"1/2 LB":"spread"===e.itemData.cat?"One Pound":"pastry"===e.itemData.cat?"Six Pack(s)":"mystery"===e.itemData.cat?"Single(s)":"N/A"},l=function(e){return e.quantity*e.unitPriceInDollars},u=function(e,t,a){if(!e||!e.items)return 0;let n=0;for(let o=0;o<e.items.length;o++){const i=e.items[o];if(i.selection===a&&"bagel"===i.itemData.cat&&i.itemData.name===t){n=i.quantity;break}if("spread"===i.itemData.cat&&i.itemData.name===t){n=i.quantity;break}if("pastry"===i.itemData.cat&&i.itemData.name===t){n=i.quantity;break}}return n},d={items:[],subtotalInDollars:0,taxInDollars:0,totalQuantity:0,discountAmountInDollars:0,finalPriceInDollars:0,desiredShipDate:new Date,isGuest:!1},h=async function(e){const t=localStorage.getItem("cartToken"),a=localStorage.getItem("loginToken");if(t){const o=await fetch("".concat((0,n.F1)(),"/api/shop/carts/applyMembershipPricing"),{method:"POST",headers:{"Content-Type":"application/json","Cart-Token":"Bearer ".concat(t),Authorization:"Bearer ".concat(a)}});if(o.ok){const t=await o.json();localStorage.setItem("cartToken",t.cartToken),e&&e(t.cart),console.log("Membership pricing successfully applied!")}else console.log("User is not a member.")}},g=function(e){let t=0,a=0;return e.items.map((e=>{switch(e.itemData.cat){case"bagel":a+=e.quantity;break;case"spread":t+=e.quantity}})),1===t&&6===a},m=async function(e,t,a,o){if(t)if(o)if(a<=0)alert("You do not have any deliveries remaining this billing cycle.");else{const e=await fetch("".concat((0,n.F1)(),"/api/memberships/create-club-checkout-session"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("loginToken")),"cart-token":"Bearer ".concat(localStorage.getItem("clubCartToken"))},body:JSON.stringify({shipDate:o})}),t=await e.json();t.sessionUrl&&(window.location.href=t.sessionUrl)}else alert("You must select a ship date to place your order.");else alert('To place your order you must have 6 "Two Packs" and 1 "1/2 LB" spread in your cart.')}}}]);
//# sourceMappingURL=822.d2f5c8bf.chunk.js.map